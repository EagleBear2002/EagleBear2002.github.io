<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">
  <link rel="mask-icon" href="/images/avatar.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-big-counter.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"eaglebear2002.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":400,"display":"always","padding":18,"offset":12,"onmobile":true,"scroll_to_top_on_sidebar_toggle":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="前端性能 Service is too busy  为什么网站性能很重要？  40% 在等待页面加载 3 秒后放弃网站 80% 的人不会再回来 几乎一半的人会告诉别人他们的负面经历 亚马逊：每提高 100MS，收入增加 1%">
<meta property="og:type" content="article">
<meta property="og:title" content="Web 前端开发-13-前端性能优化">
<meta property="og:url" content="https://eaglebear2002.github.io/38144/index.html">
<meta property="og:site_name" content="EagleBear2002 的博客">
<meta property="og:description" content="前端性能 Service is too busy  为什么网站性能很重要？  40% 在等待页面加载 3 秒后放弃网站 80% 的人不会再回来 几乎一半的人会告诉别人他们的负面经历 亚马逊：每提高 100MS，收入增加 1%">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130165150096.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130165209040.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130165212745.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130165732744.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170043964.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170114162.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170157691.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170222050.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170255087.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170258842.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170357383.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170450333.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170533316.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170658485.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170840173.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170843848.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130170958451.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130171003296.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130171021129.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130171411814.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130171418232.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130171714526.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130172522866.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130172532272.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130172540580.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130172822009.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130172825550.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/13-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.jpg">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130172902042.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130173129124.png">
<meta property="og:image" content="https://eaglebear2002.github.io/38144/image-20230130173142158.png">
<meta property="article:published_time" content="2023-01-30T08:51:00.000Z">
<meta property="article:modified_time" content="2025-10-02T04:11:35.724Z">
<meta property="article:author" content="EagleBear2002">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://eaglebear2002.github.io/38144/image-20230130165150096.png">

<link rel="canonical" href="https://eaglebear2002.github.io/38144/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Web 前端开发-13-前端性能优化 | EagleBear2002 的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<script>
  hljs.initLineNumbersOnLoad();
</script>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">EagleBear2002 的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">这里必须根绝一切犹豫，这里任何怯懦都无济于事</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">61</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">3</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">481</span></a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/eaglebear2002" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eaglebear2002.github.io/38144/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="EagleBear2002">
      <meta itemprop="description" content="暮雪朝霜，毋改英雄意气">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EagleBear2002 的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Web 前端开发-13-前端性能优化
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-30 16:51:00" itemprop="dateCreated datePublished" datetime="2023-01-30T16:51:00+08:00">2023-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-02 12:11:35" itemprop="dateModified" datetime="2025-10-02T12:11:35+08:00">2025-10-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E8%BD%AF%E4%BB%B6%E5%AD%A6%E9%99%A2%E6%9C%AC%E7%A7%91%E8%AF%BE%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">南京大学软件学院本科课程</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E8%BD%AF%E4%BB%B6%E5%AD%A6%E9%99%A2%E6%9C%AC%E7%A7%91%E8%AF%BE%E7%A8%8B/2022Fall-Web-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">2022Fall-Web 前端开发</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前端性能">前端性能</h2>
<h3 id="Service-is-too-busy">Service is too busy</h3>
<p><img src="/38144/image-20230130165150096.png" alt></p>
<h3 id="为什么网站性能很重要？">为什么网站性能很重要？</h3>
<ol>
<li>40% 在等待页面加载 3 秒后放弃网站</li>
<li>80% 的人不会再回来</li>
<li>几乎一半的人会告诉别人他们的负面经历</li>
<li>亚马逊：每提高 100MS，收入增加 1%</li>
</ol>
<table>
<thead>
<tr>
<th><img src="/38144/image-20230130165209040.png" alt></th>
<th><img src="/38144/image-20230130165212745.png" alt></th>
</tr>
</thead>
</table>
<h3 id="网站速度与-SEO">网站速度与 SEO</h3>
<p>网站速度对你的 SEO 工作很重要，因为更快的网站是：</p>
<ol>
<li>更容易爬取</li>
<li>更容易访问</li>
<li>更有利于排名（尽管这是边际的）</li>
<li>最重要的是，更有可能留住访客！</li>
</ol>
<h2 id="Web-性能优化">Web 性能优化</h2>
<p>Web 性能优化（Web Performance Optimization，WPO）：</p>
<ol>
<li>网站越快，用户的黏性越高：参与度</li>
<li>网站越快，用户忠诚度更高：留存率</li>
<li>网站越快，用户转化率越高。</li>
</ol>
<h3 id="延迟与带宽">延迟与带宽</h3>
<p>延迟：分组从信息源发送到目的地所需的时间。</p>
<p>带宽：逻辑或物理通信路径最大的吞吐量。</p>
<img src="/38144/image-20230130165732744.png" style="zoom: 67%;">
<h2 id="延迟的构成要素">延迟的构成要素</h2>
<ul>
<li>传播延迟：消息从发送端到接收端需要的时间，是信号传播距离和速度的函数</li>
<li>传输延迟：把消息中的所有比特转移到链路中需要的时间，是消息长度和链路速率的函数</li>
<li>处理延迟：处理分组首部、检查位错误及确定分组目标所需的时间</li>
<li>排队延迟：到来的分组排队等待处理的时间</li>
</ul>
<h2 id="Web-性能要点">Web 性能要点</h2>
<ul>
<li>延迟和带宽对 Web 性能的影响；</li>
<li>传输协议（TCP) 对 HTTP 的限制；</li>
<li>HTTP 协议自身的功能和缺陷；</li>
<li>Web 应用的发展趋势及性能需求；</li>
<li>浏览器局限性和优化思路。</li>
</ul>
<p>不同层之间总是相互依赖， 但优化方式却有很多可能性。任何优化建议和最佳做法都不是一成不变的，涉及的每个要素都是动态发展的：</p>
<ul>
<li>浏览器越来越快</li>
<li>用户上网条件不断改善</li>
<li>Web 应用的功能和复杂度也与日俱增</li>
</ul>
<h2 id="浏览器页面渲染机制">浏览器页面渲染机制</h2>
<img src="/38144/image-20230130170043964.png" style="zoom:33%;">
<h3 id="导航">导航</h3>
<ul>
<li>DNS 查询</li>
<li>TCP 握手：一旦获取到服务器 IP 地址，浏览器就会通过 TCP“三次握手”（en-US) 与服务器建立连接。TCP 的“三次握手”技术经常被称为“SYN-SYN-ACK”。</li>
<li>TLS 协商：为了在 HTTPS 上建立安全连接，另一种握手是必须的。更确切的说是 TLS 协商，它决定了什么密码将会被用来加密通信，验证服务器，在进行真实的数据传输之前建立安全连接。在发送真正的请求内容之前还需要三次往返服务器。</li>
</ul>
<img src="/38144/image-20230130170114162.png" style="zoom: 50%;">
<h3 id="响应">响应</h3>
<p>初始请求的响应包含所接收数据的第一个字节。Time to First Byte（TTFB）是用户通过点击链接进行请求与收到第一个 HTML 数据包之间的时间。</p>
<p>初始页面加载的 14KB 规则，第一个内容分块通常是 14KB 的数据。</p>
<p>TCP 慢启动 / 14KB 规则：</p>
<ul>
<li>第一个响应数据包是 14KB 大小的。这是慢启动的一部分，慢启动是一种均衡网络连接速度的算法。慢启动逐渐增加发送数据的数量直到达到网络的最大带宽。</li>
<li>在 TCP 慢启动中，在收到初始包之后，服务器会将下一个数据包的大小加倍到大约 28KB。后续的数据包依次是前一个包大小的二倍直到达到预定的阈值，或者遇到拥塞。</li>
</ul>
<img src="/38144/image-20230130170157691.png" style="zoom:50%;">
<h3 id="解析">解析</h3>
<p>一旦浏览器收到数据的第一块，它就可以开始解析收到的信息。“解析”是浏览器将通过网络接收的数据转换为 DOM 和 CSSOM 的步骤，通过渲染器把 DOM 和 CSSOM 在屏幕上绘制成页面。</p>
<img src="/38144/image-20230130170222050.png" style="zoom:33%;">
<h3 id="构建-DOM-树">构建 DOM 树</h3>
<p>第一步是处理 HTML 标记并构造 DOM 树。HTML 解析涉及到 tokenization 和树的构造。</p>
<p>当解析器发现非阻塞资源，例如一张图片，浏览器会请求这些资源并且继续解析。当遇到一个 CSS 文件时，解析也可以继续进行，但是对于 <code>&lt;script&gt;</code> 标签（特别是没有 async 或者 defer 属性的）会阻塞渲染并停止 HTML 的解析。尽管浏览器的预加载扫描器加速了这个过程，但过多的脚本仍然是一个重要的瓶颈。</p>
<img src="/38144/image-20230130170255087.png" style="zoom:33%;">
<img src="/38144/image-20230130170258842.png" style="zoom: 50%;">
<h3 id="预加载扫描器">预加载扫描器</h3>
<p>浏览器构建 DOM 树时，这个过程占用了主线程。当这种情况发生时，预加载扫描仪将解析可用的内容并请求高优先级资源，如 CSS、JavaScript 和 web 字体。多亏了预加载扫描器，我们不必等到解析器找到对外部资源的引用来请求它。它将在后台检索资源，以便在主
HTML 解析器到达请求的资源时，它们可能已经在运行，或者已经被下载。预加载扫描仪提供的优化减少了阻塞。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;styles.css&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;myscript.js&quot;</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;myimage.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;image description&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;anotherscript.js&quot;</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="构建-CSSOM-树">构建 CSSOM 树</h3>
<p>CSS 对象模型，简称为 CSSOM。</p>
<p>第二步是处理 CSS 并构建 CSSOM 树。CSS 对象模型和 DOM 是相似的。DOM 和 CSSOM 是两棵树。它们是独立的数据结构。浏览器将 CSS 规则转换为可以理解和使用的样式映射。浏览器遍历 CSS 中的每个规则集，根据 CSS 选择器创建具有父、子和兄弟关系的节点树。</p>
<p><img src="/38144/image-20230130170357383.png" alt></p>
<h3 id="其他过程">其他过程</h3>
<p>JavaScript 编译：当 CSS 被解析并创建 CSSOM 时，其他资源，包括 JavaScript 文件正在下载（借助预加载扫描器）。JavaScript 被解释、编译、解析和执行。脚本被解析为抽象语法树。一些浏览器引擎使用抽象语法树并将其传递到解释器中，输出在主线程上执行的字节码。这就是所谓的 JavaScript 编译。</p>
<p>构建辅助功能树：浏览器还构建辅助设备用于分析和解释内容的辅助功能（accessibility）树。无障碍对象模型（AOM）类似于 DOM 的语义版本。当 DOM 更新
时，浏览器会更新辅助功能树。辅助技术本身无法修改无障碍树。在构建 AOM 之前，屏幕阅读器（screen readers (en-US)）无法访问内容。</p>
<h3 id="渲染">渲染</h3>
<p>渲染步骤包括样式、布局、绘制，在某些情况下还包括合成。在解析步骤中创建的 CSSOM 树和 DOM 树组合成一个 Render 树，然后用于计算每个可见元素的布局，然后将其绘制到屏幕上。在某些情况下，可以将内容提升到它们自己的层并进行合成，通过在 GPU 而不是 CPU 上绘制屏幕的一部分来提高性能，从而释放主线程。</p>
<p><img src="/38144/image-20230130170450333.png" alt></p>
<h3 id="Style">Style</h3>
<p>第三步是将 DOM 和 CSSOM 组合成一个 Render 树，计算样式树或渲染树从 DOM 树的根开始构建，遍历每个可见节点。</p>
<p>像 <code>&lt;head&gt;</code> 和它的子节点以及任何具有 display: none 样式的节点，例如 <code>script { display: none; }</code>（在 user agent stylesheets 可以看到这个样式）这些标签将不会显示，也就是它们不会出现在 Render 树上。具有 <code>visibility: hidden</code> 的节点会出现在 Render 树上，因为它们会占用空间。由于我们没有给出任何指令来覆盖用户代理的默认值，因此上面
代码示例中的 script 节点将不会包含在 Render 树中。</p>
<p>每个可见节点都应用了其 CSSOM 规则。Render 树保存所有具有内容和计算样式的可见节点——将所有相关样式匹配到 DOM 树中的每个可见节点，并根据 CSS 级联确定每个节点的计算样式。</p>
<h3 id="布局">布局</h3>
<p>第四步是在渲染树上运行布局以计算每个节点的几何体。布局（Layout）是确定呈现树中所有节点的宽度、高度和位置，以及确定页面上每个对象的大小和位置的过程。回流（reflow）是对页面的任何部分或整个文档的任何后续大小和位置的确定。</p>
<p>第一次确定节点的大小和位置称为布局随后对节点大小和位置的重新计算称为回流构建渲染树后，开始布局。渲染树标识显示哪些节点（即使不可见）及其计算样式，但不标识每个节点的尺寸或位置。为了确定每个对象的确切大小和位置，浏览器从渲染树的根开始遍历它。</p>
<p><img src="/38144/image-20230130170533316.png" alt></p>
<h3 id="绘制">绘制</h3>
<p>最后一步是将各个节点绘制到屏幕上，第一次出现的节点称为 first meaningful paint (en-US)。在绘制或光栅化阶段，浏览器将在布局阶段计算的每个框转换为屏幕上的实际像素。</p>
<p>为了确保平滑滚动和动画，占据主线程的所有内容，包括计算样式，以及回流和绘制，必须让浏览器在 16.67 毫秒内完成。</p>
<p>为了确保重绘的速度比初始绘制的速度更快，屏幕上的绘图通常被分解成数层。如果发生这种情况，则需要进行合成。</p>
<p>绘制可以将布局树中的元素分解为多个层。将内容提升到 GPU 上的层（而不是 CPU 上的主线程）可以提高绘制和重新绘制性能。</p>
<p>分层确实可以提高性能，但是它以内存管理为代价，因此不应作为 web 性能优化策略的一部分过度使用。</p>
<p>当文档的各个部分以不同的层绘制，相互重叠时，必须进行合成，以确保它们以正确的顺序绘制到屏幕上，并正确显示内容。</p>
<h3 id="交互">交互</h3>
<p>一旦主线程绘制页面完成，你会认为我们已经“准备好了”，但事实并非如此。如果加载包含 JavaScript（并且延迟到 onload 事件激发后执行），则主线程可能很忙，无法用于滚动、触摸和其他交互。</p>
<p>Time to Interactive (en-US)（TTI）是测量从第一个请求导致 DNS 查询和 SSL 连接到页面可交互时所用的时间——可交互是 First Contentful Paint (en-US) 之后的时间点，页面在 50ms 内响应用户的交互。如果主线程正在解析、编译和执行 JavaScript，则它不可用，因此无法及时（小于 50ms）响应用户交互。</p>
<p>每当浏览器遇到脚本标签时，DOM 构造就会暂停！整个 DOM 构建过程都将停止，直到脚本执行完成。JavaScript 可以同时修改 DOM 和 CSSOM</p>
<p>在默认情况下，每个脚本都是一个解析器阻断器！例外，async</p>
<h3 id="关键渲染路径">关键渲染路径</h3>
<p>周密的关键渲染路径（CRP）优化策略使浏览器能够通过确定优先加载的资源以及资源加载的顺序来尽可能快地加载页面。</p>
<p>优化 CRP：提升页面加载速度需要通过被加载资源的优先级、控制它们加载的顺序和减小这些资源的体积。性能提示包含：</p>
<ol>
<li>通过异步、延迟加载或者消除非关键资源来减少关键资源的请求数量，</li>
<li>优化必须的请求数量和每个请求的文件体积，</li>
<li>通过区分关键资源的优先级来优化被加载关键资源的顺序，来缩短关键路径长度。</li>
</ol>
<p><img src="/38144/image-20230130170658485.png" alt></p>
<h3 id="现代-Web-应用程序剖析">现代 Web 应用程序剖析</h3>
<p>2022 年末，一个普通的 Web 应用由下列内容构成：</p>
<p>71 个请求，发送到 15 个主机，总下载量 2284 KB</p>
<ul>
<li>HTML：2 个请求，29 KB</li>
<li>图片：22 个请求，1001 KB</li>
<li>JavaScript：22 个请求，515 KB</li>
<li>CSS：7 个请求，75 KB</li>
<li>Font：4 个请求，144 KB</li>
<li>其他资源：3 个请求，1 KB</li>
<li>视频：3 个请求，3472 KB</li>
</ul>
<p><img src="/38144/image-20230130170840173.png" alt></p>
<p><img src="/38144/image-20230130170843848.png" alt></p>
<h3 id="时间和用户感知">时间和用户感知</h3>
<table>
<thead>
<tr>
<th>Delay</th>
<th>User Perception</th>
</tr>
</thead>
<tbody>
<tr>
<td>0-100 ms</td>
<td>Instant 很快</td>
</tr>
<tr>
<td>100-300 ms</td>
<td>Small perceptible delay 有一点点慢</td>
</tr>
<tr>
<td>300-1000 ms</td>
<td>Machine is working 机器在工作呢</td>
</tr>
<tr>
<td>1,000+ ms</td>
<td>Likely mental context switch 先干点别的吧</td>
</tr>
<tr>
<td>10,000+ ms</td>
<td>Task is abandoned 不能用了</td>
</tr>
</tbody>
</table>
<h3 id="资源瀑布图">资源瀑布图</h3>
<p><img src="/38144/image-20230130170958451.png" alt></p>
<p><img src="/38144/image-20230130171003296.png" alt></p>
<h2 id="性能要素：计算、渲染、网络">性能要素：计算、渲染、网络</h2>
<p>web 程序的执行主要包括三个任务： 获取资源，页面布局和渲染，以及 JavaScript 执行。</p>
<ul>
<li>更多带宽并不重要</li>
<li>延迟是性能瓶颈</li>
</ul>
<p><img src="/38144/image-20230130171021129.png" alt></p>
<h3 id="Benchmark-工具">Benchmark 工具</h3>
<p>Apache Bench：apache 自带的一款功能强大的测试工具。</p>
<p>Siege 一款开源的压力测试工具，可以根据配置对一个 WEB 站点进行多用户的并发访问，记录每个用户所有请求过程的相应时间，并在一定数量的并发访问下重复进行。<a target="_blank" rel="noopener" href="http://www.joedog.org/JoeDog/Siege">http://www.joedog.org/JoeDog/Siege</a></p>
<p>http_load (Excellent for latency tests)</p>
<ul>
<li>程序非常小，解压后也不到 100K</li>
<li>http_load 以并行复用的方式运行，用以测试 web 服务器的吞吐量与负载。</li>
<li><a target="_blank" rel="noopener" href="http://www.acme.com/software/http_load/">http://www.acme.com/software/http_load/</a></li>
</ul>
<p>阿里云性能测试（Performance Testing）：一个 SaaS 性能测试平台，具有强大的分布式压测能力，可模拟海量用户真实的业务场景，</p>
<p>Tsung：一个开源的支持多协议的分布式压力测试工具</p>
<ul>
<li>目前支持 HTTP 分布式压力测试、WebDAV 分布式压力测试、SOAP 分布式压力测试、PostgreSQL 分布式压力</li>
<li>测试、MySQL 分布式压力测试、LDAP 分布式压力测试、MQTT 分布式压力测试、Jabber/XMPP servers 分布式压力测试</li>
</ul>
<p>JMeter：</p>
<ul>
<li>作为一款广为流传的开源分布式压测产品，能自动生成图形报告。最初被设计用于 Web 应用测试，如今 JMeter 可以用于测试静态和动态资源，例如静态文件、Java 小服务程序、CGI 脚本、Java 对象、数据库、FTP 服务器等等，还能对服务器、网络或对象模拟巨大的负载，通过不同压力类别测试它们的强度和分析整体性能。另外，JMeter 能够对应用程序做功能测试和回归测试。</li>
</ul>
<h3 id="影响基准数据的因素">影响基准数据的因素</h3>
<ul>
<li>地理位置</li>
<li>网络问题</li>
<li>响应大小</li>
<li>代码处理</li>
<li>浏览器的行为</li>
<li>Web 服务器配置</li>
</ul>
<h3 id="问题">问题</h3>
<p>人造测试不能发现所有性能瓶颈：</p>
<ol>
<li>场景及页面选择：很难重复真实用户的导航模式；</li>
<li>浏览器缓存：用户缓存不同，性能差别很大；</li>
<li>中介设施：中间代理和缓存对性能影响很大；</li>
<li>硬件多样化：不同的 CPU、GPU 和内存比比皆是；</li>
<li>浏览器多样化：各种浏览器版本，有新有旧；</li>
<li>上网方式：真实连接的带宽和延迟可能不断变化。</li>
</ol>
<h3 id="性能监控指标">性能监控指标</h3>
<p>FP（全称“First Paint”，“首次绘制”）：对于应用页面，首次出现视觉上不同于跳转之前内容的时间点，或者说是页面发生第一次绘制的时间点。</p>
<p>FCP（全称“First Contentful Paint”，“首次内容绘制”）：指浏览器完成渲染 DOM 中第一部分内容（可能是文本、图像或其他任何元素）的时间点，此时用户应该在视觉上有直观的感受。注意：只有首次绘制文本、图片（包含背景图）、非白色的 canvas 或 SVG 时才被算作 FCP。</p>
<p>FP 与 FCP 这两个指标之间的主要区别是：</p>
<ul>
<li>FP 是当浏览器开始绘制内容到屏幕上的时候，只要在视觉上开始发生变化，无论是什么内容触发的视觉变化，在这一刻，这个时间点，叫做 FP。</li>
<li>相比之下，FCP 指的是浏览器首次绘制来自 DOM 的内容。例如：文本，图片，SVG，canvas 元素等，这个时间点叫 FCP。</li>
<li>FP 和 FCP 可能是相同的时间，也可能是先 FP 后 FCP。</li>
</ul>
<p>FMP（全称“First Meaningful Paint”，翻译为“首次有意义绘制”）：指页面关键元素的渲染时间。</p>
<ul>
<li>没有标准化定义，因为关键元素可以由开发者自行定义。</li>
<li>FMP 本质上是通过一个算法来猜测某个时间点可能是 FMP，所以有时候不准。</li>
</ul>
<p>首屏时间：进入页面之后，应用渲染完成整个手机屏幕（未滚动之前）内容的时间。</p>
<p>业界对于这个指标没有确切定论，比如是否包含屏幕内图片的渲染完成时间。</p>
<p>用户可交互时间：用户可以与应用进行交互的时间：</p>
<ul>
<li>一般来说，是 DOMReady 的时间，因为通常会在这时绑定事件操作。</li>
<li>如果页面中涉及交互的脚步没有下载完成，那么当然没有到达所谓的用户可交互时间。</li>
</ul>
<p>总下载时间：页面所有资源加载完成所需要的时间。</p>
<ul>
<li>一般可以统计 window.onload 时间，这样可以统计出同步加载的资源全部加载完的耗时。</li>
<li>如果页面中存在较多的异步渲染，那么可以将异步渲染全部完成的时间做为总下载时间。</li>
</ul>
<p>自定义指标：由于应用特点不同，可以根据需求自定义时间。</p>
<ul>
<li>比如，一个类似 Instagram 的页面由图片瀑布流组成，那么可能非常关心屏幕中第一排图片渲染完成的时间。</li>
</ul>
<h3 id="导航计时-Navigation-Timing-2">导航计时 Navigation Timing 2</h3>
<img src="/38144/image-20230130171411814.png" style="zoom: 80%;">
<img src="/38144/image-20230130171418232.png" style="zoom:50%;">
<ol>
<li>DNS 查询耗时 = domainLookupEnd - domainLookupStart</li>
<li>TCP 连接耗时 = connectEnd - connectStart</li>
<li>请求响应耗时 = responseEnd - requestStart</li>
<li>白屏时间 = domLoading - navigationStart</li>
<li>首屏时间 = loadEventStart - navigationStart</li>
<li>DOM 树解析耗时 = domInteractive - domLoading</li>
<li>Domready 时间 = domComplete - navigationStart</li>
<li>onload 时间 = loadEventEnd - navigationStart</li>
</ol>
<h3 id="Performance-API">Performance API</h3>
<p>Performance 接口可以获取到当前页面中与性能相关的信息。它是 High Resolution Time API 的一部分，同时也融合了 Performance Timeline API、Navigation Timing API、 User Timing API 和 Resource Timing API。</p>
<p>该类型的对象可以通过调用只读属性 Window.performance 来获得。</p>
<p>功能强大，但并不适用于所有场景。比如，如果在单页应用中改变 URL 但不刷新页面（单页应用的典型路由方案），那么使用 window.performance.timing 所获取的数据是不会更新的，还需要开发者重新设计统计方案。同时，window.performance.timing 可能无法满足一些自定义的数据。</p>
<h3 id="分析工具">分析工具</h3>
<p>基于网页分析工具：</p>
<ul>
<li>Web PageTest, <a target="_blank" rel="noopener" href="http://www.webpagetest.org/">http://www.webpagetest.org/</a></li>
<li>PingDom Tools</li>
<li>GTmetrix, <a target="_blank" rel="noopener" href="https://gtmetrix.com/">https://gtmetrix.com/</a></li>
<li>Google PageSpeed, <a target="_blank" rel="noopener" href="https://developers.google.com/speed/">https://developers.google.com/speed/</a></li>
<li>whatsmydns, <a target="_blank" rel="noopener" href="https://www.whatsmydns.net">https://www.whatsmydns.net</a></li>
</ul>
<p>基于浏览器分析工具：</p>
<ul>
<li>Chrome 自带工具 F12</li>
<li>Firefox 插件：YSlow（Yahoo 工具）</li>
<li>Page Speed（google）</li>
</ul>
<h3 id="浏览器优化">浏览器优化</h3>
<p>可行的优化手段会因浏览器而异，但从核心优化策略来说，可以宽泛地分为两类：</p>
<ul>
<li>
<p>基于文档的优化：熟悉网络协议，了解文档、CSS 和 JavaScript 解析管道，发现和优先安排关键网络资源，尽早分派请求并取得页面，使其尽快达到可交互的状态。主要方法是优先获取资源、提前解析等。</p>
</li>
<li>
<p>推测性优化：浏览器可以学习用户的导航模式，执行推测性优化，尝试预测用</p>
<p>户的下一次操作。然后，预先解析 DNS、预先连接可能的目标。</p>
</li>
</ul>
<h3 id="大多数浏览器利用的四种技术">大多数浏览器利用的四种技术</h3>
<p>好消息是，所有这些优化都由浏览器替我们自动完成，经常可以节省几百 ms 的网络延迟。既然如此，那理解这些优化背后的原理就至关重要了，这样才能利用浏览器的这些特性，提升应用性能。大多数浏览器都利用了如下四种技术。</p>
<ul>
<li>
<p>资源预取和排定优先次序：文档、CSS 和 JavaScript 解析器可以与网络协议层沟 DNS 预解析：对可能的域名进行提前解析，避免将来 HTTP 请求时的 DNS 延迟。预解析可以通过学习导航历史、用户的鼠标悬停，或其他页面信号来触发。</p>
</li>
<li>
<p>TCP 预连接：DNS 解析之后，浏览器可以根据预测的 HTTP 请求，推测性地打开页面预渲染：某些浏览器可以让我们提示下一个可能的目标，从而在隐藏的标签页中推测优化</p>
</li>
</ul>
<p>预解析特定的域名：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;dns-prefetch&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//hostname_to_resolve.com&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
<p>预取得页面后面要用到的关键性资源：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;subresource&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/javascript/myapp.js&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
<p>预取得将来导航要用的资源：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;prefetch&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/images/big.jpeg&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
<p>根据对用户下一个目标的预测，预渲染特定页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;prerender&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//example.org/next_page.html&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="优化应用程序交付">优化应用程序交付</h3>
<p><img src="/38144/image-20230130171714526.png" alt></p>
<h2 id="最佳实践">最佳实践</h2>
<p>两个准则：</p>
<ol>
<li>消除或减少不必要的网络延迟</li>
<li>将需要传输的数据压缩至最少。</li>
</ol>
<h3 id="性能准则">性能准则</h3>
<p>减少 DNS 查找：每一次主机名解析都需要一次网络往返，从而增加请求的延迟时间，同时还会阻塞后续请求。</p>
<p>重用 TCP 连接：尽可能使用持久连接，以消除 TCP 握手和慢启动延迟。</p>
<p>减少 HTTP 重定向：HTTP 重定向极费时间，特别是不同域名之间的重定向，更加费时；这里面既有额外的 DNS 查询、TCP 握手，还有其他延迟。最佳的重定向次数为零。</p>
<p>使用 CDN（内容分发网络）：把数据放到离用户地理位置更近的地方，可以显著减少每次 TCP 连接的网络延迟，增大吞吐量。这一条既适用于静态内容，也适用于动态内容。</p>
<p>去掉不必要的资源：任何请求都不如没有请求快。</p>
<h3 id="其他准则">其他准则</h3>
<p>在客户端缓存资源：应该缓存应用资源，从而避免每次请求都发送相同的内容。</p>
<p>传输压缩过的内容：传输前应该压缩应用资源，把要传输的字节减至最少：确保对每种要传输的资源采用最好的压缩手段。</p>
<p>消除不必要的请求开销：减少请求的 HTTP 首部数据（比如 HTTP cookie），节省的时间相当于几次往返的延迟时间。</p>
<p>并行处理请求和响应：请求和响应的排队都会导致延迟，无论是客户端还是服务器端。这一点经常被忽视，但却会无谓地导致很长延迟。</p>
<p>针对协议版本采取优化措施：HTTP 1.x 支持有限的并行机制，要求打包资源、跨域分散资源，等等。相对而言，HTTP2.0 只要建立一个连接就能实现最优性能，同时无需针对 HTTP 1.x 的那些优化方法。</p>
<h3 id="在客户端缓存资源">在客户端缓存资源</h3>
<p>要说最快的网络请求，那就是不用发送请求就能获取资源。将之前下载过的数据缓存并维护好，就可以做到这一点。对于通过 HTTP 传输的资源，要保证首部包含适当的缓存字段：</p>
<ul>
<li>Cache-Control 首部用于指定缓存时间；</li>
<li>Last-Modified 和 ETag 首部提供验证机制。</li>
</ul>
<h3 id="压缩传输的数据">压缩传输的数据</h3>
<p>利用本地缓存可以让客户端避免每次请求都重复取得数据。不过，还是有一些资源是必须取得的，比如原来的资源过期了，或者有新资源，再或者资源不能缓存。对于这些资源，应该保证传输的字节数最少。因此要保证对它们进行最有效的压缩。</p>
<p>HTML、CSS 和 JavaScript 等文本资源的大小经过 gzip 压缩平均可以减少 60%~80%。 而图片则需要仔细考量：</p>
<ol>
<li>图片一般会占到一个网页需要传输的总字节数的一半；</li>
<li>通过去掉不必要的元数据可以把图片文件变小；</li>
<li>要调整大小就在服务器上调整，避免传输不必要的字节；</li>
<li>应该根据图像选择最优的图片格式；</li>
<li>尽可能使用有损压缩。</li>
</ol>
<h3 id="消除不必要的请求字节">消除不必要的请求字节</h3>
<p>HTTP 是一种无状态协议，也就是说服务器不必保存每次请求的客户端的信息。然而，很多应用又依赖于状态信息以实现会话管理、个性化、分析等功能。为了实现这些功能，HTTP State Management Mechanism(RFC 2965) 作为扩展，允许任何网站针对自身来源关联和更新 cookie 元数据：浏览器保存数据，而在随后发送给来源的每一个请求的 Cookie 首部中自动附加这些信息。</p>
<p>上述标准并未规定 cookie 最大不能超过多大，但实践中大多数浏览器都将其限制为 4 KB。与此同时，该标准还规定每个站点针对其来源可以有多个关联的 cookie。于是，一个来源的 cookie 就有可能多达几十 KB！不用说，这么多元数据随请求传递，必然会给应用带来明显的性能损失：</p>
<ol>
<li>浏览器会在每个请求中自动附加关联的 cookie 数据；</li>
<li>在 HTTP 1.x 中，包括 cookie 在内的所有 HTTP 首部都会在不压缩的状态下传输；</li>
<li>在 HTTP 2.0 中，这些元数据经过压缩了，但开销依然不小；</li>
<li>最坏的情况下，过大的 HTTP cookie 会超过初始的 TCP 拥塞窗口，从而导致多余的网络往返。</li>
</ol>
<h3 id="并行处理请求和响应">并行处理请求和响应</h3>
<p>要是想实现最佳性能，就要记住以下几点：</p>
<ol>
<li>使用持久连接，从 HTTP 1.0 升级到 HTTP 1.1；</li>
<li>利用多个 HTTP 1.1 连接实现并行下载；</li>
<li>可能的情况下利用 HTTP 1.1 管道；</li>
<li>考虑升级到 HTTP 2.0 以提升性能；</li>
<li>确保服务器有足够的资源并行处理请求。</li>
</ol>
<h3 id="HTTP1-x-优化建议">HTTP1.x 优化建议</h3>
<p>针对 HTTP 1.x 的优化次序很重要：首先要配置服务器以最大限度地保证 TCP 和 TLS 的性能最优，然后再谨慎地选择和采用移动及经典的应用最佳实践，之后再度量，迭代。</p>
<p>采用了经典的应用优化措施和适当的性能度量手段，还要进一步评估是否有必要为应用采取特定于 HTTP 1.x 的优化措施（其实是权宜之计）。</p>
<ul>
<li>利用 HTTP 管道：如果你的应用可以控制客户端和服务器这两端，那么使用管道可以显著减少网络延迟。</li>
<li>采用域名分区：如果你的应用性能受限于默认的每来源 6 个连接，可以考虑将资源分散到多个来源。</li>
<li>打包资源以减少 HTTP 请求：拼接和精灵图等技巧有助于降低协议开销，又能达成类似管道的性能提升。</li>
<li>嵌入小资源：考虑直接在父文档中嵌入小资源，从而减少请求数量。</li>
</ul>
<p>管道缺乏支持，而其他优化手段又各有各的利弊。事实上，这些优化措施如果过于激进或使用不当，反倒会伤害性能。总之，要有务实的态度，通过度量来评估各种措施对性能的影响，在此基础上再迭代改进。 天底下就没有包治百病的灵丹妙药！！！</p>
<h3 id="针对-HTTP-2-0-的优化">针对 HTTP 2.0 的优化</h3>
<p>HTTP 2.0 的主要目标就是提升传输性能，实现客户端与服务器间较低的延迟和较高的吞吐量。显然，在 TCP 和 TLS 之上实现最佳性能，同时消除不必要的网络延迟， 从来没有如此重要过。</p>
<ul>
<li>服务器的初始 cwnd 应该是 10 个分组； TCP 的拥塞控制主要原理依赖于一个拥塞窗口（cwnd）来控制，在之前我们还讨论过 TCP 还有一个对端通告的接收窗口（rwnd）用于流量控制。</li>
<li>服务器应该通过 ALPN（针对 SPDY 则为 NPN）协商支持 TLS；
<ul>
<li>ALPN（Application Layer Protocol Negotiation，应用层协议协商），ALPN 是客户端发送所支持的 HTTP 协议列表，由服务端选择；</li>
<li>NPN（Next Protocol Negotiation，下一代协议协商）是服务端发送所支持的 HTTP 协议列表，由客户端选择。</li>
</ul>
</li>
<li>服务器应该支持 TLS 恢复以最小化握手延迟。</li>
</ul>
<p>要通过 HTTP 2.0 获得最佳性能，特别是从每个来源仅用一个连接的角度说，的确需要各层协议的紧密配合。</p>
<p>接下来，或许有点意外，那就是采用移动及其他经典的最佳做法： 少发数据、削减请求，根据无线网络情况调整资源供给。不管使用什么版本的协议，减少传输的数据量和消除不必要的网络延迟，对任何应用都是最有效的优化手段。</p>
<p>最后，杜绝和忘记域名分区、文件拼接、图片精灵等不良的习惯，这些做法在 HTTP 2.0 之上完全没有必要。事实上，继续使用这些手段反而有害！可以利用 HTTP 2.0 内置的多路分发以及服务器推送等新功能。</p>
<h3 id="去掉对-1-x-的优化">去掉对 1.x 的优化</h3>
<p>每个来源使用一个连接：HTTP 2.0 通过将一个 TCP 连接的吞吐量最大化来提升性能。事实上，在 HTTP 2.0 之下再使用多个连接（比如域名分区）反倒成了一种反模式，因为多个连接会抵
消新协议中首部压缩和请求优先级的效用。</p>
<p>去掉不必要的文件合并和图片拼接：打包资源的缺点很多，比如缓存失效、占用内存、延缓执行，以及增加应用复杂性。有了 HTTP 2.0，很多小资源都可以并行发送，导致打包资源的效率反而更低。</p>
<p>利用服务器推送：之前针对 HTTP 1.x 而嵌入的大多数资源，都可以而且应该通过服务器推送来交付。这样一来，客户端就可以分别缓存每个资源，并在页面间实现重用，而不必把它们放到每个页面里了。</p>
<p>要获得最佳性能，应该尽可能把所有资源都集中在一个域名之下。域名分区在 HTTP 2.0 之下属于反模式，对发挥协议的性能有害：分区是开始，之后影响会逐渐扩散。打包资源不会影响 HTTP 2.0 协议本身，但对缓存性能和执行速度有负面影响。</p>
<h3 id="双协议应用策略">双协议应用策略</h3>
<p>相同的应用代码，双协议部署：相同的应用代码可能通过 HTTP 1.x 也可能通过 HTTP 2.0 交付。可能任何一种协议之下都达不到最佳性能，但可以追求性能足够好。所谓足够好，需要通过针对每一种应用单独度量来保证。这种情况下，第一步可以先撤销域名分区以实现 HTTP 2.0 交付。然后，随着更多用户迁移到 HTTP 2.0，可以继续撤销资源打包并尽可能利用服务器推送。</p>
<p>分离应用代码，双协议部署：根据协议不同分别交付不同版本的应用。这样会增加运维的复杂性，但实践中对很多应用倒是十分可行。比如，一台负责完成连接的边界服务器可以根据协商后的协议版本，把客户端请求引导至适当的服务器。</p>
<p>动态 HTTP 1.x 和 HTTP 2.0 优化：某些自动化的 Web 优化框架，以及开源及商业产品，都可以在响应请求时动态重写交付的应用代码（包括连接、拼合、分区，等等）。此时，服务器也可以考虑协商的协议版本，并动态采用适当的优化策略。</p>
<p>HTTP 2.0，单协议部署：如果应用可以控制服务器和客户端，那没理由不只使用 HTTP 2.0。事实上，如果真有这种可能，那就应该专一使用 HTTP 2.0。</p>
<p>谷歌的 PageSpeed Optimization Libraries(PSOL) 提供了 40 多种“Web 优化过滤器”的开源实现，可以集成到任何服务器运行时，动态应用各种优化策略。</p>
<h3 id="WebpageTest">WebpageTest</h3>
<p><img src="/38144/image-20230130172522866.png" alt></p>
<h3 id="Simple-Testing">Simple Testing</h3>
<p><img src="/38144/image-20230130172532272.png" alt></p>
<h3 id="结果">结果</h3>
<p><img src="/38144/image-20230130172540580.png" alt></p>
<h3 id="指标">指标</h3>
<ol>
<li>网页级指标 (Page-level Metrics)：这些是为整个页面捕获并显示的顶级度量值。</li>
<li>整页加载时间 (Load Time)：测量的时间是从初始化请求，到开始执行 window.onload 事件。</li>
<li>页面所有元素加载时间 (Fully Loaded)：从初始化请求，到 Document Complete 后，2 秒内（中间几百毫秒轮询）没有网络活动的时间，但这 2 秒是不包括在测
量中的，所以会出现两个差值大于或小于 2 秒。</li>
<li>第一个字节加载时间 (First Byte)：第一个字节时间（通常缩写为 TTFB）被测量为从初始化请求，到服务器响应的第一个字节，被浏览器接收的时间（不包括 DNS 查询、TCP 连接的时间）。</li>
<li>页面渲染时间 (Start Render)：测量的时间是从初始化请求，到第一个内容被绘制到浏览器显示的时间。在瀑布图中有两个参数指标 Start Render 和 msFirstPaint。</li>
</ol>
<ul>
<li>Start Render 是通过捕获页面加载的视频，并在浏览器第一次显示除空白页之外的其他内容时查看每个帧来衡量的。它只能在实验室测量，通常是最准确的测量。</li>
<li>msFirstPaint（IE 专用属性）是由浏览器本身报告的一个测量，它认为绘制的第一个内容。通常是相当准确，但有时它报告的时候，浏览器只画一个空白屏幕。</li>
</ul>
<ol start="6">
<li>首屏展现平均值 (Speed Index)：表示页面呈现用户可见内容的速度（越低越好）。有关如何计算的更多信息，请参见：Speed Index。</li>
<li>DOM 元素数量 (DOM Elements)：在测试结束时测试页面上的 DOM 元素的计数。</li>
<li>请求级度量标准 (Request-level Metrics)：这些是为每个请求捕获和显示的度量。</li>
</ol>
<p><img src="/38144/image-20230130172822009.png" alt></p>
<p><img src="/38144/image-20230130172825550.png" alt></p>
<h3 id="Filmstrip-View">Filmstrip View</h3>
<p><img src="/38144/13-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.jpg" alt></p>
<p><img src="/38144/image-20230130172902042.png" alt></p>
<h3 id="网飞网络性能案例研究">网飞网络性能案例研究</h3>
<p>改善 <a target="_blank" rel="noopener" href="http://Netflix.com">Netflix.com</a> 在桌面的交互时间</p>
<p>通过改进 <a target="_blank" rel="noopener" href="http://Netflix.com">Netflix.com</a> 注册过程中所使用的 JavaScript 及预加载技术，开发团队能够为移动用户和桌面用户提供更好的用户体验，主要改进如下：</p>
<ul>
<li>加载和交互时间减少了 50%（<a target="_blank" rel="noopener" href="http://Netflix.com">Netflix.com</a> 桌面登录主页）；</li>
<li>在从 React 和其他客户端库切换到普通的 JavaScript 之后，JavaScript 包大小减少了 200KB。服务器端仍然使用 React。</li>
<li>HTML、CSS、JavaScript（React）预加载使后续页面的浏览交互时间减少了 30%。</li>
</ul>
<h3 id="减少-JavaScript-传输，缩短交互时间">减少 JavaScript 传输，缩短交互时间</h3>
<p>Netflix 针对其登录主页的性能进行了优化：这个页面最初包含 300KB 的 JavaScript，其中一些是 React 和其他客户端代码（比如像 Lodash 这样的实用程序库），还有一些是补充 React 状态所需的上下文数据。</p>
<p>使用 Chrome 的开发工具和 Lighthouse 模拟在 3G 连接上加载登录主页，结果显示，登录主页需要 7 秒的加载时间，对于一个简单的登录页面来说太长了，因此需要研究改进的可能。通过一些性能审计，Netflix 发现他们客户端的 JS 开销很高。</p>
<p>登录主页是否真得需要 React？用 Vanilla JavaScript 替换！！！</p>
<h3 id="优化">优化</h3>
<p>移植到原生 JavaScript 的组件列表：</p>
<ul>
<li>基础交互（主页选项卡）</li>
<li>语言切换器</li>
<li>“Cookie 横幅（Cookie banner）”（针对非美国用户）</li>
<li>客户端日志分析</li>
<li>性能度量和记录</li>
<li>广告归属检测引导代码（出于安全考虑，放在沙箱式 iFrame 中）</li>
</ul>
<h3 id="结果-2">结果</h3>
<p>尽管 React 最初占用的空间仅为 45KB，但将 React、几个库和相应的应用程序代码从客户端移除后，JavaScript 的总量减少了 200KB 以上，这使得 Netflix 在登录主页的交互时间减少了 50% 以上。</p>
<p><img src="/38144/image-20230130173129124.png" alt></p>
<h3 id="后续页面的-React-预加载">后续页面的 React 预加载</h3>
<p>预加载：</p>
<ul>
<li>通过浏览器内置的 API 和 XHR 预加载</li>
<li>交互时间减少了 30%</li>
</ul>
<p><img src="/38144/image-20230130173142158.png" alt></p>
<h3 id="Robots-txt">Robots.txt</h3>
<p>“网络爬虫排除标准”（Robots Exclusion Protocol），网站通过 Robots 协议告诉搜索引擎哪些页面可以抓取，哪些页面不能抓取。</p>
<ul>
<li>源自 1994</li>
<li><a target="_blank" rel="noopener" href="https://www.robotstxt.org/robotstxt.html">https://www.robotstxt.org/robotstxt.html</a></li>
</ul>
<p>Robots 协议是国际互联网界通行的道德规范，基于以下原则建立：</p>
<ol>
<li>搜索技术应服务于人类，同时尊重信息提供者的意愿，并维护其隐私权；</li>
<li>网站有义务保护其使用者的个人信息和隐私不被侵犯。</li>
</ol>
<p>robots 是一个协议。robots.txt 文件是一个文本文件，放置在网站根目录下。</p>
<h3 id="Robots-txt-例子">Robots.txt 例子</h3>
<p>任何机器人都不应该访问任何以“/yoursite/temp/”开头的 URL，除了名为“IxeBot”的机器人：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">User-agent: * Disallow: /yoursite/temp/ User-agent: IxeBot Disallow:<br></code></pre></td></tr></table></figure>
<h2 id="总结">总结</h2>
<p>密切关注 JavaScript 的开销</p>
<p>Netflix 的折中方案是，使用 React 在服务器端渲染登录页面，但同时也为注册过程的其他部分预取 React 代码。这不仅优化了首次加载性能，还优化了注册过程其余部分的加载时间，因为它是单页应用，所以有更大的 JS 包需要下载。</p>
<p>补充：</p>
<ul>
<li>Netflix 考虑过 Preact，但是，对于一个交互性比较低的简单页面流，使用普通的 JavaScript 是一个更简单的选择。</li>
<li>Netflix 尝试使用 Service Workers 进行静态资源缓存。当时，Safari 不支持这个 API（现在支持了），但他们现在又在探索这个 API。Netflix 的注册过程需要比客户体验更多的遗留浏览器支持。许多用户会在旧的浏览器上注册，但会在他们本地的移动应用程序或电视设备上观看 Netflix。</li>
<li>Netflix 的登录页面极为动态。这是他们的注册过程中进行 A/B 测试最多的页面，机器学习模型用于根据位置、设备类型和许多其他因素定制消息和图像。支持近 200 个国家，每个派生页面都面对着不同的本地化、法律和价值信息挑战。</li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat-award.jpg" alt="EagleBear2002 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="EagleBear2002 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/27436/" rel="prev" title="异体汉字成因及处理">
      <i class="fa fa-chevron-left"></i> 异体汉字成因及处理
    </a></div>
      <div class="post-nav-item">
    <a href="/14835/" rel="next" title="商务智能-03-联机分析处理">
      商务智能-03-联机分析处理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD"><span class="nav-number">1.</span> <span class="nav-text">前端性能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-is-too-busy"><span class="nav-number">1.1.</span> <span class="nav-text">Service is too busy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E5%BE%88%E9%87%8D%E8%A6%81%EF%BC%9F"><span class="nav-number">1.2.</span> <span class="nav-text">为什么网站性能很重要？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%AB%99%E9%80%9F%E5%BA%A6%E4%B8%8E-SEO"><span class="nav-number">1.3.</span> <span class="nav-text">网站速度与 SEO</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">2.</span> <span class="nav-text">Web 性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E4%B8%8E%E5%B8%A6%E5%AE%BD"><span class="nav-number">2.1.</span> <span class="nav-text">延迟与带宽</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E7%9A%84%E6%9E%84%E6%88%90%E8%A6%81%E7%B4%A0"><span class="nav-number">3.</span> <span class="nav-text">延迟的构成要素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web-%E6%80%A7%E8%83%BD%E8%A6%81%E7%82%B9"><span class="nav-number">4.</span> <span class="nav-text">Web 性能要点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6"><span class="nav-number">5.</span> <span class="nav-text">浏览器页面渲染机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E8%88%AA"><span class="nav-number">5.1.</span> <span class="nav-text">导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94"><span class="nav-number">5.2.</span> <span class="nav-text">响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90"><span class="nav-number">5.3.</span> <span class="nav-text">解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-DOM-%E6%A0%91"><span class="nav-number">5.4.</span> <span class="nav-text">构建 DOM 树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E5%8A%A0%E8%BD%BD%E6%89%AB%E6%8F%8F%E5%99%A8"><span class="nav-number">5.5.</span> <span class="nav-text">预加载扫描器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-CSSOM-%E6%A0%91"><span class="nav-number">5.6.</span> <span class="nav-text">构建 CSSOM 树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E8%BF%87%E7%A8%8B"><span class="nav-number">5.7.</span> <span class="nav-text">其他过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93"><span class="nav-number">5.8.</span> <span class="nav-text">渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Style"><span class="nav-number">5.9.</span> <span class="nav-text">Style</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B1%80"><span class="nav-number">5.10.</span> <span class="nav-text">布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6"><span class="nav-number">5.11.</span> <span class="nav-text">绘制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92"><span class="nav-number">5.12.</span> <span class="nav-text">交互</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84"><span class="nav-number">5.13.</span> <span class="nav-text">关键渲染路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E4%BB%A3-Web-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%89%96%E6%9E%90"><span class="nav-number">5.14.</span> <span class="nav-text">现代 Web 应用程序剖析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%92%8C%E7%94%A8%E6%88%B7%E6%84%9F%E7%9F%A5"><span class="nav-number">5.15.</span> <span class="nav-text">时间和用户感知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E7%80%91%E5%B8%83%E5%9B%BE"><span class="nav-number">5.16.</span> <span class="nav-text">资源瀑布图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E8%A6%81%E7%B4%A0%EF%BC%9A%E8%AE%A1%E7%AE%97%E3%80%81%E6%B8%B2%E6%9F%93%E3%80%81%E7%BD%91%E7%BB%9C"><span class="nav-number">6.</span> <span class="nav-text">性能要素：计算、渲染、网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Benchmark-%E5%B7%A5%E5%85%B7"><span class="nav-number">6.1.</span> <span class="nav-text">Benchmark 工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%B1%E5%93%8D%E5%9F%BA%E5%87%86%E6%95%B0%E6%8D%AE%E7%9A%84%E5%9B%A0%E7%B4%A0"><span class="nav-number">6.2.</span> <span class="nav-text">影响基准数据的因素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">6.3.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="nav-number">6.4.</span> <span class="nav-text">性能监控指标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E8%88%AA%E8%AE%A1%E6%97%B6-Navigation-Timing-2"><span class="nav-number">6.5.</span> <span class="nav-text">导航计时 Navigation Timing 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Performance-API"><span class="nav-number">6.6.</span> <span class="nav-text">Performance API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="nav-number">6.7.</span> <span class="nav-text">分析工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%98%E5%8C%96"><span class="nav-number">6.8.</span> <span class="nav-text">浏览器优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%A7%E5%A4%9A%E6%95%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E5%88%A9%E7%94%A8%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%8A%80%E6%9C%AF"><span class="nav-number">6.9.</span> <span class="nav-text">大多数浏览器利用的四种技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%BA%A4%E4%BB%98"><span class="nav-number">6.10.</span> <span class="nav-text">优化应用程序交付</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">7.</span> <span class="nav-text">最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E5%87%86%E5%88%99"><span class="nav-number">7.1.</span> <span class="nav-text">性能准则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%87%86%E5%88%99"><span class="nav-number">7.2.</span> <span class="nav-text">其他准则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98%E8%B5%84%E6%BA%90"><span class="nav-number">7.3.</span> <span class="nav-text">在客户端缓存资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9%E4%BC%A0%E8%BE%93%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">7.4.</span> <span class="nav-text">压缩传输的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E9%99%A4%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E8%AF%B7%E6%B1%82%E5%AD%97%E8%8A%82"><span class="nav-number">7.5.</span> <span class="nav-text">消除不必要的请求字节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94"><span class="nav-number">7.6.</span> <span class="nav-text">并行处理请求和响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP1-x-%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">7.7.</span> <span class="nav-text">HTTP1.x 优化建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%92%88%E5%AF%B9-HTTP-2-0-%E7%9A%84%E4%BC%98%E5%8C%96"><span class="nav-number">7.8.</span> <span class="nav-text">针对 HTTP 2.0 的优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%BB%E6%8E%89%E5%AF%B9-1-x-%E7%9A%84%E4%BC%98%E5%8C%96"><span class="nav-number">7.9.</span> <span class="nav-text">去掉对 1.x 的优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E5%8D%8F%E8%AE%AE%E5%BA%94%E7%94%A8%E7%AD%96%E7%95%A5"><span class="nav-number">7.10.</span> <span class="nav-text">双协议应用策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebpageTest"><span class="nav-number">7.11.</span> <span class="nav-text">WebpageTest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple-Testing"><span class="nav-number">7.12.</span> <span class="nav-text">Simple Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C"><span class="nav-number">7.13.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E6%A0%87"><span class="nav-number">7.14.</span> <span class="nav-text">指标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Filmstrip-View"><span class="nav-number">7.15.</span> <span class="nav-text">Filmstrip View</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E9%A3%9E%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6"><span class="nav-number">7.16.</span> <span class="nav-text">网飞网络性能案例研究</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%8F%E5%B0%91-JavaScript-%E4%BC%A0%E8%BE%93%EF%BC%8C%E7%BC%A9%E7%9F%AD%E4%BA%A4%E4%BA%92%E6%97%B6%E9%97%B4"><span class="nav-number">7.17.</span> <span class="nav-text">减少 JavaScript 传输，缩短交互时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96"><span class="nav-number">7.18.</span> <span class="nav-text">优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C-2"><span class="nav-number">7.19.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%BB%AD%E9%A1%B5%E9%9D%A2%E7%9A%84-React-%E9%A2%84%E5%8A%A0%E8%BD%BD"><span class="nav-number">7.20.</span> <span class="nav-text">后续页面的 React 预加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Robots-txt"><span class="nav-number">7.21.</span> <span class="nav-text">Robots.txt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Robots-txt-%E4%BE%8B%E5%AD%90"><span class="nav-number">7.22.</span> <span class="nav-text">Robots.txt 例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">8.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="EagleBear2002"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">EagleBear2002</p>
  <div class="site-description" itemprop="description">暮雪朝霜，毋改英雄意气</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">481</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/EagleBear2002" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;EagleBear2002" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:eaglebear2002@foxmail.com" title="E-Mail → mailto:eaglebear2002@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://czxingchen.github.io/" title="https:&#x2F;&#x2F;czxingchen.github.io&#x2F;" rel="noopener" target="_blank">PL 顶会研究者-XiaoZhi</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/the-sword-of-king/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;the-sword-of-king&#x2F;" rel="noopener" target="_blank">模式识别专家-崖山剑</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://en.ydjsir.com.cn/" title="https:&#x2F;&#x2F;en.ydjsir.com.cn&#x2F;" rel="noopener" target="_blank">愿逐月华流照君-YDJSIR</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/m0_51691879?spm=1000.2115.3001.5343" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;m0_51691879?spm&#x3D;1000.2115.3001.5343" rel="noopener" target="_blank">软院科协掌门人-wbl_z</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://itxia.club/" title="https:&#x2F;&#x2F;itxia.club&#x2F;" rel="noopener" target="_blank">侠之大者为国为民-IT 侠</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://chestnutsilver.github.io/TJIS-My-Helloworld/" title="https:&#x2F;&#x2F;chestnutsilver.github.io&#x2F;TJIS-My-Helloworld&#x2F;" rel="noopener" target="_blank">因果推断爱好者-ChestnutSilver</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://atritium.github.io/" title="https:&#x2F;&#x2F;atritium.github.io&#x2F;" rel="noopener" target="_blank">任天堂技术扛把子-manqi</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.sakiyary.cn/" title="https:&#x2F;&#x2F;blog.sakiyary.cn&#x2F;" rel="noopener" target="_blank">教育部教学创新项目负责人-哈气鸭梨</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://huoxj.github.io/" title="https:&#x2F;&#x2F;huoxj.github.io&#x2F;" rel="noopener" target="_blank">离百年博客还有 98 年捞程序 Runz</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.erinwithbmq.xin/" title="https:&#x2F;&#x2F;www.erinwithbmq.xin&#x2F;" rel="noopener" target="_blank">摸鱼小能手 ErinwithBMQ の 尋夢之旅</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://tilnel.github.io/" title="https:&#x2F;&#x2F;tilnel.github.io&#x2F;" rel="noopener" target="_blank">南大耐摔王 Tilnel 的杂谈小屋</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.azifan.club/" title="https:&#x2F;&#x2F;blog.azifan.club&#x2F;" rel="noopener" target="_blank">水龙之魂</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://mzy0624.github.io/" title="https:&#x2F;&#x2F;mzy0624.github.io&#x2F;" rel="noopener" target="_blank">Haibara AI</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">EagleBear2002</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">2.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">40:11</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : ,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>










<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
